<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario - Consulta</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-bottom: 10px; }
    input, button { padding: 8px; margin: 5px; border: none; cursor: pointer; }
    #btnAll { background-color: #4CAF50; color: white; }
    #btnClear { background-color: gray; color: white; }
    #contador { font-size: 18px; margin: 15px 0; font-weight: bold; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f4f4f4; cursor: pointer; }
    td { cursor: default; }
    td.clickable { color: blue; text-decoration: underline; cursor: pointer; }

    /* Modal */
    #modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
    }
    #modal-content {
      background: white;
      margin: 5% auto;
      padding: 20px;
      width: 90%;
      max-width: 900px;
      border-radius: 6px;
      max-height: 80vh;
      overflow-y: auto;
    }
    #closeModal {
      background: red;
      color: white;
      padding: 6px 12px;
      border: none;
      cursor: pointer;
      float: right;
    }
  </style>
</head>
<body>

<h2>Inventario de C√≥mputo</h2>

<div>
  <input type="text" id="buscar" placeholder="Buscar por empleado...">
  <button id="btnAll">Mostrar todo</button>
  <button id="btnClear">Limpiar</button>
</div>

<div id="contador"></div>

<table id="tabla">
  <thead><tr id="thead"></tr></thead>
  <tbody id="tbody"></tbody>
</table>

<!-- Modal flotante -->
<div id="modal">
  <div id="modal-content">
    <button id="closeModal">Cerrar</button>
    <h3>Detalle del empleado</h3>
    <table id="tablaDetalle">
      <thead><tr id="theadDetalle"></tr></thead>
      <tbody id="tbodyDetalle"></tbody>
    </table>
  </div>
</div>

<script>
// ‚ö†Ô∏è Sustituye con tu enlace CSV publicado en Google Sheets
const URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrq42GMJqgn_ib5x9t1OH894InFgOPmGqgxX_HSPtdG-OE0ldgf_f9c-Tk_cG3HzhcZbSAuOOZPcoR/pub?gid=1357523642&single=true&output=csv";

let filas = [];
let headers = [];
let sortDirection = {}; // Para saber si es asc/desc por columna
const tbody = document.getElementById("tbody");
const thead = document.getElementById("thead");
const contador = document.getElementById("contador");
const inputBuscar = document.getElementById("buscar");

// ‚úÖ Columnas principales
const columnasVisibles = ["Empleado","Area","Oficina","Marca","Modelo","Serie","Procesador","Tipo"];

fetch(URL)
  .then(res => res.text())
  .then(csv => {
    filas = csv.trim().split("\n").map(r => r.split(","));
    headers = filas[0];
    construirVista();
  })
  .catch(err => console.error("Error cargando CSV:", err));

function construirVista() {
  const rows = filas.slice(1);

  // √çndices de columnas visibles
  let indices = columnasVisibles.map(c => headers.indexOf(c));
  // Asegurar "Tipo" = √∫ltima columna
  indices[indices.length - 1] = headers.indexOf("Tipo") !== -1 ? headers.indexOf("Tipo") : headers.length - 1;

  // Construir encabezado con √≠conos de ordenamiento
  thead.innerHTML = columnasVisibles.map((h, idx) => 
    `<th onclick="ordenarTabla(${indices[idx]})">${h} <span id="icon-${indices[idx]}">‚ÜïÔ∏è</span></th>`
  ).join("");
  
  tbody.innerHTML = "";

  const textoBusqueda = inputBuscar.value.trim().toLowerCase();

  const filtrados = rows.filter(r => {
    const empleado = (r[headers.indexOf("Empleado")] || "").toLowerCase();
    return textoBusqueda === "" || empleado.includes(textoBusqueda);
  });

  contador.textContent = `Total: ${filtrados.length}`;

  filtrados.forEach(fila => {
    const tr = document.createElement("tr");
    indices.forEach((i, idx) => {
      const td = document.createElement("td");
      let valor = fila[i] && fila[i].trim() !== "" ? fila[i] : "N/A";

      // Empleado siempre en may√∫sculas
      if (columnasVisibles[idx] === "Empleado") {
        valor = valor.toUpperCase();
        td.classList.add("clickable");
        td.onclick = () => mostrarDetalle(valor);
      }

      td.textContent = valor;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

// üîπ Ordenar tabla por columna
function ordenarTabla(colIndex) {
  const rows = filas.slice(1);
  sortDirection[colIndex] = !sortDirection[colIndex]; // alternar orden

  rows.sort((a, b) => {
    const valA = (a[colIndex] || "").toUpperCase();
    const valB = (b[colIndex] || "").toUpperCase();
    if (valA < valB) return sortDirection[colIndex] ? -1 : 1;
    if (valA > valB) return sortDirection[colIndex] ? 1 : -1;
    return 0;
  });

  filas = [headers].concat(rows); // reconstruir matriz
  construirVista();

  // Actualizar √≠cono visual
  document.querySelectorAll("thead span").forEach(s => s.textContent = "‚ÜïÔ∏è");
  document.getElementById(`icon-${colIndex}`).textContent = sortDirection[colIndex] ? "üîº" : "üîΩ";
}

// Mostrar detalle en modal
function mostrarDetalle(empleado) {
  const rows = filas.slice(1).filter(r => (r[headers.indexOf("Empleado")] || "").toUpperCase() === empleado.toUpperCase());

  document.getElementById("theadDetalle").innerHTML = headers.map(h => `<th>${h}</th>`).join("");
  const tbodyDetalle = document.getElementById("tbodyDetalle");
  tbodyDetalle.innerHTML = "";

  rows.forEach(fila => {
    const tr = document.createElement("tr");
    headers.forEach((h, i) => {
      const td = document.createElement("td");
      let valor = fila[i] && fila[i].trim() !== "" ? fila[i] : "N/A";
      if (h === "Empleado") valor = valor.toUpperCase();
      td.textContent = valor;
      tr.appendChild(td);
    });
    tbodyDetalle.appendChild(tr);
  });

  document.getElementById("modal").style.display = "block";
}

// Cerrar modal
document.getElementById("closeModal").onclick = () => {
  document.getElementById("modal").style.display = "none";
};

// Buscar con Enter
inputBuscar.addEventListener("keypress", e => {
  if (e.key === "Enter") construirVista();
});

// Bot√≥n Mostrar todo
document.getElementById("btnAll").onclick = () => {
  inputBuscar.value = "";
  construirVista();
};

// Bot√≥n Limpiar
document.getElementById("btnClear").onclick = () => {
  inputBuscar.value = "";
  tbody.innerHTML = "";
  contador.textContent = "";
  thead.innerHTML = columnasVisibles.map(h => `<th>${h}</th>`).join("");
};
</script>

</body>
</html>
